---
title: "analysis"
site: bookdown::bookdown_site
documentclass: book
output:
  bookdown::gitbook: default
---
# Analysis

```{r}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(lme4)
library(tidyverse)
library(broom)
library(ggsignif)
library(patchwork)
library(scico)
library(Cairo)
library(Hmisc)
library(gghalves)
library(cowplot)
library(ggnewscale)
library(ggeffects)
library(here)
library(effsize)
```

```{r}
blocks <- c(1, 2, 3, 4)
trials <- c(1:16)
objects <- c("monster", "partyhat", "lamp", "flower")
if (dir.exists(here("figures"))){dir.create(here("figures"))}
```

retrieving subject IDs from the directory
```{r, eval=FALSE}
fn <- list.files(path = here("data"), pattern="*_feedbackPhase_block4_Sum") 
subjects <- c()
for (i_file in length(fn)) {
  subjects <- substr(fn,1,4)
}
```

```{r data}
Sum_all <- read_delim(here("data" ,"Sum.txt"), delim = " ", col_names = TRUE) # JB: path specification. TO DO: column specification. Would save work when later recoding the variables for mixed model
Traj <- read_delim(here("data" ,"Traj.txt"), delim = " ", col_names = TRUE) # JB added loading of trajectory data because used below. TO DO: column specification.
```

```{r}
circleFun <- function(center = c(0,0), r = 27.5, npoints = 100){
    tt <- seq(0,2*pi,length.out = npoints)
    xx <- center[1] + r * cos(tt)
    yy <- center[2] + r * sin(tt)
    return(data.frame(x = xx, y = yy))
}

#function dist() calculates distance between given 2 points (loc1, loc2) while taking in their X and Y separately
dist <- function(loc1X, loc1Y, loc2X, loc2Y) {
   d = sqrt(((loc1X-loc2X)**2)+((loc1Y-loc2Y)**2))
   return(d)
}
```

Hypothesis: Boundary-dependent object position memory will improve between 8 and 15 years of age, while landmark-dependent object memory will stay relatively constant.

```{r}
subjects <- unique(Sum_all$ID)
```

DISTANCE/LOCATION ANALYSIS
Descriptives


exclusion factors
filtering timeout sessions
```{r}
Sum_all <- Sum_all %>% filter(error!=-1)
```

```{r exclusion t-test}
out <- c()
for (i_sub in subjects) {
  score <- t.test(subset(Sum_all, ID==i_sub & block==1)$memoryScoreTraj, 
                  mu=0.5, var.equal = FALSE, alternative = "greater") %>% tidy()
  if (score$p.value > 0.05) {
    out <- c(out, i_sub)
    }
}
print(out)

Sum_all <- Sum_all %>% 
  filter(ID != out[1]) %>% 
  filter(ID != out[2])

```

```{r visualisation of calculation of memory scores} 
#data sorting
i_sub = subjects[5]
XY <- filter(Traj, ID == i_sub) %>% select(ID, charX, charY)
XY <- XY[sample(nrow(XY), 1000), ]
graph_sub <- filter(Sum_all, ID == i_sub)
XY <- mutate(XY, distance = NA, outside = NA)
for (i_point in 1:1000){ 
  dista = dist(XY$charX[i_point], XY$charY[i_point], graph_sub$objX[10], graph_sub$objY[10])
  XY$distance[i_point] <- dista
  if (dista > graph_sub$error[10]) {XY$outside[i_point] <- TRUE} else {XY$outside[i_point] <- FALSE}
}

#final used data
outside <- filter(XY, outside == TRUE)
inside <- filter(XY, outside == FALSE)
littleCircle <- circleFun(center=c(graph_sub$objX[10],graph_sub$objY[10] ), r=graph_sub$error[10])
circle <- circleFun()

#graph
mem_score <- ggplot(circle, aes(x, y)) +
  geom_path() +
  geom_path(subset(Traj, ID %in% i_sub), mapping=aes(x=charX, y=charY), size=0.2, alpha=0.7, linetype = 1) +
  geom_point(data= outside, aes(x=charX, y=charY, color="Trajectory Locations Further"), size=0.7, alpha=0.7) +
  geom_point(data=inside, aes(x=charX, y=charY, color="Trajectory Locations Closer"), size=0.7) +
  geom_path(data=littleCircle, aes(x,y), color="#E58A50") +
  geom_point(data=graph_sub, aes(x=objX[10], y=objY[10], color="True Object Location"), size = 2) +
  geom_point(data=graph_sub, aes(x=remLocX[10], y=remLocY[10], color="Remembered Object Location"), size=2) +
  theme_cowplot() +
  theme(aspect.ratio=1, 
        axis.title = element_text(size=10), axis.text = element_text(size=10), 
        plot.title = element_text(size=12), plot.subtitle = element_text(size = 11)) +
  labs(title = "Memory score calculation based on trajectory", 
       subtitle = paste("Memory score:", graph_sub$memoryScoreTraj[10]), 
       x= 'X (virtual meters)', 
       y= 'Y (virtual meters)') +
  scale_color_manual(name = " ", 
                     values= c("True Object Location" = "#F8DF77", "Remembered Object Location" = "#95413F", 
                               "Trajectory Locations Closer" = "#E58750", "Trajectory Locations Further" = "#191900"))

ggsave(filename="memory_score_visual.pdf", plot=mem_score, units = "cm", width = 15, height = 11, dpi = "retina", 
       device = cairo_pdf, path = here("figures"))
ggsave("memory_score_visual.png", plot=mem_score, units = "cm", width = 15, height = 11, 
       dpi = "retina", device = "png", path = here("figures"))

mem_score
```


Block 1
Were they completing the study?
```{r summarise data for block 1}
summaryBlock1 <- Sum_all %>% 
  filter(block==1) %>% 
  group_by(ID, block) %>% 
  summarise(memoryScore = mean(memoryScoreTraj), distanceOther = mean(averageDist), distanceTrue = mean(error), .groups="drop")
```

```{r memory score vs 0.5, one-sample t-test}
t.test(summaryBlock1$memoryScore, mu = 0.5) %>% tidy()
```

```{r memory score graph}
mem_score_B1 <- ggplot(summaryBlock1, aes(x=block, y= memoryScore)) + 
  geom_half_violin(aes(x=block-0.06), fill=scico(1, palette = "lajolla", begin = 0.45), alpha =0.5, color=NA) +
  geom_point(aes(x=block+0.08), position = position_jitter(width =0.01, height = 0), shape=16, size = 1) +
  geom_boxplot(width = .05, outlier.shape = NA) +
  theme_cowplot() +
  geom_hline(yintercept = 0.5, linetype=2) +
  ylab('Memory Score (0-1)') + xlab('') + 
  ggtitle("Memory Score") + 
  theme(axis.text.x = element_blank(), 
        axis.ticks.x = element_blank(),
        aspect.ratio =1, 
        plot.title = element_text(face="italic", size=12)) +
  annotate("text", label="chance = 0.5", x=1.2, y=0.52, size=3) 

ggsave("memory_score_B1.pdf", plot=mem_score_B1, units = "cm", width = 10, height = 7, 
       dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("memory_score_B1.png", plot=mem_score_B1, units = "cm", width = 10, height = 7, 
       dpi = "retina", device = "png", path = here("figures"))

mem_score_B1
```

```{r heat map}
heatMapDat <- Sum_all %>%
  filter(block==1) %>% 
  select(ID, miniblock, objX, objY, remLocX, remLocY, cue, block) %>% 
  mutate(newX = remLocX-objX, newY = remLocY - objY) 

heat_map_B1 <- ggplot(heatMapDat, aes(x=newX, y=newY)) + # JB: Please follow up on the warnings that are returned!
  theme_cowplot() +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  geom_point(alpha=0.2, color="white", size=0.05) +
  scale_fill_scico(palette = 'lajolla', begin=1, end=0, name = "Density") +
  theme(aspect.ratio=1,
        plot.title = element_text(face="italic", size=12),
        legend.title = element_text(size=10),
        legend.text = element_text(size=10)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  labs(x = "Error on X (vm)", y = "Error on Y (vm)", title="Centralised Distribution of Error") +
  scale_x_continuous(limits = c(-32, 32), breaks = c(-30, -20, -10, 0, 10, 20, 30)) + 
  scale_y_continuous(limits = c(-32, 32), breaks = c(-30, -20, -10, 0, 10, 20, 30)) +
  geom_path(data = circle, aes(x, y), color="grey") 

ggsave("heatMap_block1.pdf", plot=heat_map_B1, units = "cm", width = 10, height = 10, dpi = "retina", 
       device = cairo_pdf, path = here("figures"))
ggsave("heatMap_block1.png", plot=heat_map_B1, units = "cm", width = 10, height = 10, dpi = "retina", 
       device = "png", path = here("figures"))

heat_map_B1
```

```{r}
memory_B1 <- mem_score_B1 + heat_map_B1 &
  theme(axis.text = element_text(size=10), 
        axis.title=element_text(size=10), 
        plot.title = element_text(size=12)) &
  plot_annotation(title = 'Memory Performance in Block 1',
                  theme = theme(plot.title = element_text(size = 12, face="bold"))) 


ggsave("Block1_loc.pdf", plot=memory_B1, units = "cm", width = 15.9, height = 10, dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("Block1_loc.png", plot=memory_B1, units = "cm", width = 15.9, height = 10, dpi = "retina", device = "png", path = here("figures"))

memory_B1
```

```{r distance to incorrect objects vs the cued object t-test}
t.test(summaryBlock1$distanceOther, summaryBlock1$distanceTrue, var.equal = FALSE, paired = TRUE) %>% tidy()
```

```{r pivoting the summary for the graph}
summaryBlock1 <- pivot_longer(summaryBlock1, cols=c(distanceTrue, distanceOther))
```

```{r distance error visualisation}
distance_B1 <- ggplot(summaryBlock1, aes(x=name, y= value)) + 
  scale_x_discrete(limits = c('distanceTrue', 'distanceOther'),
                   labels = c('to Correct Location', 'to Other Object Locations')) + 
  scale_y_continuous(breaks = c(5, 10, 15, 20 , 25), limits = c(0, 28)) +
  gghalves::geom_half_violin(data=summaryBlock1 %>% filter(name=="distanceOther"), 
                             position=position_nudge(+0.2), aes(fill=name),alpha =0.7, color=NA, side="r") +
  gghalves::geom_half_violin(data=summaryBlock1 %>% filter(name=="distanceTrue"), 
                             position=position_nudge(-0.2), aes(fill=name),alpha =0.7, color=NA, side="l") + 
  scale_fill_scico_d(palette = 'lajolla', begin=0.2, end=0.75) +
  geom_point(shape=16, size = 1) +
  geom_boxplot(data=summaryBlock1 %>% filter(name=="distanceOther"), 
               position=position_nudge(+0.1), width = .1, outlier.shape = NA) +
  geom_boxplot(data=summaryBlock1 %>% filter(name=="distanceTrue"), 
               position=position_nudge(-0.1), width = .1, outlier.shape = NA) +
  geom_line(aes(group=ID), alpha=0.5) +
  theme_cowplot() +
  labs(x = " ", y = "Distance (Virtual Meters)", subtitle = "In Block 1", 
       title = "Distance from Remembered Location to Object Locations") + 
  theme(legend.position = "none", 
        plot.title = element_text(size=12, lineheight = 1.1), 
        plot.subtitle = element_text(face = "bold", lineheight = 1.1),
        aspect.ratio = 0.55,
        axis.title = element_text(size=12)) +
  geom_signif(comparisons = list(c("distanceTrue", "distanceOther")), test="t.test", 
              test.args=list(alternative = "two.sided", var.equal = FALSE, paired=TRUE),
              map_signif_level = TRUE, tip_length = 0, extend_line = 0.045, y_position = 26)


ggsave("distances_B1.pdf", plot=distance_B1, units = "cm", width = 13, height = 10, dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("distances_B1.png", plot=distance_B1, units = "cm", width = 13, height = 10, dpi = "retina", device = "png", path = here("figures"))

distance_B1
```


Cues
```{r summarise the data for rest of the analysis}
subset_RI <- Sum_all %>% 
  filter(block!=1) %>% 
  select(-object, -sec2Beg, -sec2Est, -dropTime, -sec2End, -trialLen, -secTrialEst) 

relativeInfluenceBlocks <- subset_RI %>%
  group_by(ID, cue) %>% 
  summarise(relativeInf = mean(relativeInfluence), 
            corCueRI = mean(correct_RI),
            distanceError = mean(error), 
            age=unique(age), 
            .groups="drop") 
```

```{r t-test of RI vs 0.5 landmark}
t.test(subset(relativeInfluenceBlocks, cue=="landmark")$relativeInf, 
       mu = 0.5, alternative = "less") %>% tidy()
```

```{r t-test of RI vs 0.5 boundary}
t.test(subset(relativeInfluenceBlocks, cue=="boundary")$relativeInf, 
       mu = 0.5, alternative = "greater") %>% tidy()
```

```{r t-test RI boundary vs landmark}
t.test(subset(relativeInfluenceBlocks, cue=="boundary")$relativeInf, 
       subset(relativeInfluenceBlocks, cue=="landmark")$relativeInf, paired=TRUE) %>% tidy()
```

```{r relative influence block 2-4 graph}
rel_Inf <- ggplot(relativeInfluenceBlocks, aes(x=cue, y=relativeInf)) + 
  scale_x_discrete(labels = c('Boundary', 'Landmark')) +
  gghalves::geom_half_violin(data=relativeInfluenceBlocks %>% filter(cue=="landmark"), 
                             position=position_nudge(+0.2), aes(fill=cue),alpha =0.7, color=NA, side="r") +
  gghalves::geom_half_violin(data=relativeInfluenceBlocks %>% filter(cue=="boundary"), 
                             position=position_nudge(-0.2), aes(fill=cue),alpha =0.7, color=NA, side="l") + 
  scale_fill_scico_d(palette = 'tokyo', begin=0.15, end=0.85) +
  geom_point(shape=16, size = 1) +
  geom_boxplot(data=relativeInfluenceBlocks %>% filter(cue=="landmark"), 
               position=position_nudge(+0.1), width = .1, outlier.shape = NA) +
  geom_boxplot(data= relativeInfluenceBlocks %>% filter(cue=="boundary"), 
               position=position_nudge(-0.1), width = .1, outlier.shape = NA) +
  geom_line(aes(group=ID), alpha=0.5) +
  theme_cowplot() +
  labs(x = " ", y = "Relative Influence (0-1)", 
       title = "Positional Memory") + 
  theme(legend.position = "none", 
        plot.title = element_text(size=12, lineheight = 1.1), 
        axis.title = element_text(size=10)) +
  geom_signif(comparisons = list(c("landmark", "boundary")), test="t.test", 
              test.args=list(alternative = "two.sided", paired=TRUE), 
              map_signif_level = TRUE, tip_length = 0, extend_line = 0.045, y_position = 0.85) +
  geom_hline(yintercept=0.5, linetype=2, alpha=0.6) +
  scale_y_continuous(limits=c(0.1, 0.9), breaks = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9)) +
  annotate("text", label="*", size=2, y=0.8, x=1) +
  annotate("text", label="*", size=2, y=0.2, x=2) 

ggsave("relativeInfluence.pdf", plot=rel_Inf, units = "cm", width = 15, height = 11, dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("relativeInfluence.png", plot=rel_Inf, units = "cm", width = 15, height = 11, dpi = "retina", device = "png", path = here("figures"))

rel_Inf
```

```{r t-test distance error boundary vs landmark}
t.test(subset(relativeInfluenceBlocks, cue=="boundary")$distanceError, 
       subset(relativeInfluenceBlocks, cue=="landmark")$distanceError, paired=TRUE) %>% tidy()
```


```{r distance error graph}
g_cue <- ggplot(relativeInfluenceBlocks, aes(x=cue, y= distanceError)) + 
  scale_x_discrete(labels = c('Boundary', 'Landmark')) +
  gghalves::geom_half_violin(data=relativeInfluenceBlocks %>% filter(cue=="landmark"), 
                             position=position_nudge(+0.2), aes(fill=cue),alpha =0.7, color=NA, side="r") +
  gghalves::geom_half_violin(data=relativeInfluenceBlocks %>% filter(cue=="boundary"), 
                             position=position_nudge(-0.2), aes(fill=cue),alpha =0.7, color=NA, side="l") + 
  scale_fill_scico_d(palette = 'tokyo', begin=0.15, end=0.85) +
  geom_point(shape=16, size = 1) +
  geom_boxplot(data=relativeInfluenceBlocks %>% filter(cue=="landmark"), 
               position=position_nudge(+0.1), width = .1, outlier.shape = NA) +
  geom_boxplot(data=relativeInfluenceBlocks %>% filter(cue=="boundary"), 
               position=position_nudge(-0.1), width = .1, outlier.shape = NA) +
  geom_line(aes(group=ID), alpha=0.5) +
  theme_cowplot() +
  labs(x = " ", y = "Distance Error (vm)", title = "Positional Memory") +
  theme(legend.position = "none", 
        plot.title = element_text(size=12, lineheight = 1.1), 
        aspect.ratio = 0.55,
        axis.title = element_text(size=12)) +
  geom_signif(comparisons = list(c("landmark", "boundary")),  test="t.test", 
              test.args=list(alternative = "two.sided", paired=TRUE),
              map_signif_level = TRUE, tip_length = 0, extend_line = 0.045, y_position = 26)


ggsave("distancesError.pdf", plot=g_cue, units = "cm", width = 15, height = 11, dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("distancesError.png", plot=g_cue, units = "cm", width = 15, height = 11, dpi = "retina", device = "png", path = here("figures"))

g_cue
```

```{r simpliest MEM}
formulaCue <- "relativeInfluence ~ cueMM + (1+cueMM|ID)"
modelCue <- lme4::lmer(formula = formulaCue, data=subset_RI)
summary(modelCue)
```

```{r control MEM}
formulaCueControl<- "relativeInfluence ~ 1 + (1+cueMM|ID)"
modelCueControl <- lme4::lmer(formula = formulaCueControl, data=subset_RI)
ratioCue <- anova(modelCue, modelCueControl)
ratioCue
```


Miniblocks learning
```{r MEM for miniblocks}
formulaMiniblocksCue <- "relativeInfluence ~ cueMM*mini + (1+mini:cueMM|ID)"
modelMiniblocksCue <- lme4::lmer(formula = formulaMiniblocksCue, data=subset_RI)
summary(modelMiniblocksCue)

```

```{r testing interaction significance}
formulaMiniblocksControl <- "relativeInfluence ~ cueMM+mini + (1+mini:cueMM|ID)"
modelMiniblocksControl <- lme4::lmer(formula = formulaMiniblocksControl, data=subset_RI)

ratioMini <- anova(modelMiniblocksCue, modelMiniblocksControl)
ratioMini
```

```{r MEM for miniblocks landmark}
formulaMiniblocks <- "relativeInfluence ~ mini + (1+mini|ID)"
modelMiniblocksLandmark <- lme4::lmer(formula = formulaMiniblocks, data=subset(subset_RI, cue=="landmark"))
summary(modelMiniblocksLandmark)

formulaMiniControl <- "relativeInfluence ~ 1 + (1+mini|ID)" 
modelMiniLandmarkControl <- lme4::lmer(formula = formulaMiniControl, data=subset(subset_RI, cue=="landmark"))
ratioMiniLandmark = anova(modelMiniblocksLandmark, modelMiniLandmarkControl)
ratioMiniLandmark
```

```{r MEM for miniblocks boundary}
formulaMiniblocks <- "relativeInfluence ~ mini + (1+mini|ID)"
modelMiniblocksBoundary <- lme4::lmer(formula = formulaMiniblocks, data=subset(subset_RI,cue=="boundary"))
summary(modelMiniblocksBoundary) 

formulaMiniControl <- "relativeAngle ~ 1 + (1+mini|ID)" 
modelMiniBoundaryControl <- lme4::lmer(formula = formulaMiniControl, data=subset(subset_RI, cue=="boundary"))
ratioMiniBoundary = anova(modelMiniblocksBoundary, modelMiniBoundaryControl)
ratioMiniBoundary
```

```{r} 
summary_miniblock <- subset_RI %>% # JB: add comments please!
  group_by(ID, miniblock, cue, age) %>% 
  summarise(relativeInf = mean(relativeInfluence), 
            riSD = sd(relativeInfluence), 
            .groups = "drop")

g_mini <- ggplot(summary_miniblock, aes(miniblock, relativeInf, group=interaction(cue, ID), color=cue)) + 
  geom_line(size=0.8, alpha = 0.3) +
  stat_summary(data= subset(summary_miniblock, cue=="boundary"), fun.data=mean_se, aes(group=cue), 
               geom="errorbar", size=0.8, width=0.1, alpha=0.95, position = position_nudge(x=0.01)) +
  stat_summary(data= subset(summary_miniblock, cue=="landmark"), fun.data=mean_se, aes(group=cue),  
               geom="errorbar", size=0.8, width=0.1, alpha=0.95, position=position_nudge(x=-0.01)) +
  stat_summary(fun=mean, aes(group=cue), geom="line", size = 1.5) +
  stat_summary(fun=mean, aes(group=cue), geom="point", size=2) +
  geom_hline(yintercept = 0.5, linetype = 2) +
  theme_cowplot() +
  labs(x= "Miniblock", y = "Relative Influence (0-1)", title = "Averaged across Blocks", color = "Cue") +
  theme(plot.title = element_text(size=12, face="italic"), 
        axis.title = element_text(size=10),
        axis.text = element_text(size=10)) +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary", "Landmark")) +
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0,1)) +
  scale_x_continuous(limits = c(0.5, 4.5), breaks = c(1,2,3,4))

g_mini
```

```{r}
summary_objectTrial <- subset_RI %>%
  group_by(ID, objectTrial, cue) %>% 
  summarise(relativeInf = mean(relativeInfluence), 
            riSD = sd(relativeInfluence), 
            .groups = "drop")

g_objTrial <- ggplot(summary_objectTrial, aes(objectTrial, relativeInf, group=interaction(cue, ID), color=cue)) + 
  theme_cowplot() +
  geom_line(data= subset(summary_objectTrial, objectTrial < 9), size=0.8, alpha = 0.3) +
  geom_line(data= subset(summary_objectTrial, objectTrial < 13 & objectTrial > 8), size=0.8, alpha = 0.3) +
  geom_line(data= subset(summary_objectTrial, objectTrial > 12), size=0.8, alpha = 0.3) +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary, Landmark")) +
  theme( 
        plot.title = element_text(size=12, face="italic"), 
        axis.title = element_text(size=10),
        axis.text = element_text(size=10)) +
  labs(x= "Miniblock", y = "Relative Influence (0-1)", title= "Separately per Block", color= "Cue") +
  stat_summary(fun.data=mean_se, aes(group=cue),  
               geom="errorbar", size=0.8, width=0.1, alpha=0.95, position = position_nudge(x=0.01)) +
  stat_summary(data = subset(summary_objectTrial, objectTrial < 9), fun=mean, aes(group=cue), geom="line", size = 1.5) +
  stat_summary(data = subset(summary_objectTrial, objectTrial  < 13 & objectTrial > 8), fun=mean, aes(group=cue), 
               geom="line", size = 1.5) +
  stat_summary(data = subset(summary_objectTrial, objectTrial > 12), fun=mean, aes(group=cue), geom="line", size = 1.5) +
  stat_summary(fun=mean, aes(group=cue), geom="point", size=2) +
  geom_hline(yintercept = 0.5, linetype = 2) +
  geom_vline(xintercept = 8.9, alpha = 0.7, linetype=3) +
  geom_vline(xintercept = 12.9, alpha = 0.7, linetype=3) +
  geom_vline(xintercept = 4.9, alpha = 0.7, linetype=3) +
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0,1)) +
  scale_x_continuous(breaks = c(5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16), 
                     labels = c("1", "2", "3", "4", "1", "2", "3", "4", "1", "2", "3", "4")) +
  annotate("text", label = "Block 2", x = 5.6, y = 1, size = 4) +
  annotate("text", label = "Block 3", x = 9.6, y = 1, size = 4) +
  annotate("text", label = "Block 4", x = 13.6, y = 1, size = 4) +
  theme(legend.position = "none")

g_objTrial


```

```{r}
layout <- "
AAAAAA
AAAAAA
AAAAAA
BB####
BB#C##
BB####
"

g_leg <- guide_area()
g_min <- g_objTrial + g_mini + g_leg +
  plot_layout(design = layout, guides = "collect") &
  theme(axis.title = element_text(size = 10), axis.text = element_text(size=10), 
        legend.title = element_text(size=10), legend.text = element_text(size=10),
        plot.title = element_text(size=12, face="italic"),
        plot.tag = element_text(size = 10, face="bold")) &
  plot_annotation(title = 'Positional Memory',
                  theme = theme(plot.title = element_text(size = 12, face="bold")),
                  tag_levels = list(c('A', 'B')))

g_min

ggsave("relativeInfluence_min.pdf", plot=g_min, units = "cm", width = 15.9, height = 13, 
       dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("relativeInfluence_min.png", plot=g_min, units = "cm", width = 15.9, height = 13, 
       dpi = "retina", device = "png", path = here("figures"))

```

Age
```{r}
formulaFull <- "relativeInfluence ~ age_c*cueMM + ( 1 + cueMM | ID)" 
modelFull <- lmer(formula = formulaFull, data=subset_RI)
summary(modelFull)
```


```{r ratio Test} 
controlFinalInt <- "relativeInfluence ~ age_c + cueMM + (1 + cueMM | ID)" 
modelControl <- lmer(formula = controlFinalInt, data=subset_RI)
ratioFullModel <- anova(modelFull, modelControl)
ratioFullModel
```


```{r age model landmark}
formulaAgeLandmark <- "relativeInfluence ~ age_c + (1|ID)"
modelAgeLandmark <- lme4::lmer(formula = formulaAgeLandmark, data=subset(subset_RI, cue=="landmark"))
summary(modelAgeLandmark)

controlAgeLandmark <- "relativeInfluence ~ 1 + (1 |ID)"
modelControlAgeLandmark <- lme4::lmer(formula = controlAgeLandmark, data=subset(subset_RI, cue=="landmark"))
ratioAgeLandmark <- anova(modelAgeLandmark, modelControlAgeLandmark)
ratioAgeLandmark
```

```{r age model boundary}
formulaAgeBoundary <- "relativeInfluence ~ age_c +(1|ID)"
modelAgeBoundary <- lme4::lmer(formula = formulaAgeBoundary, data=subset(subset_RI, cue=="boundary"))
summary(modelAgeBoundary)

controlAgeBoundary <- "relativeInfluence ~ 1 + (1 |ID)"
modelControlAgeBoundary <- lme4::lmer(formula = controlAgeBoundary, data=subset(subset_RI, cue=="boundary"))
ratioAgeBoundary <- anova(modelAgeBoundary, modelControlAgeBoundary)
ratioAgeBoundary
```

```{r RI_final graph}
RI_final <- ggplot(relativeInfluenceBlocks, aes(age, relativeInf, color=cue)) + 
  theme_cowplot() +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, guide = FALSE) +
  stat_summary(fun=mean, aes(group=cue), geom="line", size = 1.5) +
  stat_summary(fun=mean, aes(group=cue), geom="point", size = 2) +
  stat_summary(fun.data=mean_se, aes(group=cue),  
               geom="errorbar", size=0.8, width=0.1, alpha=0.95) +
  new_scale_color() + 
  geom_point(aes(color=cue)) + 
  scale_color_scico_d(palette = 'tokyo', begin=0.3, end=0.7, labels = c("Boundary", "Landmark")) +
  scale_x_continuous(breaks = c(8,9,10,11,12,13,14,15)) +
  scale_y_continuous(limits = c(0.2, 0.8), breaks = c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)) +
  labs(x= "Age", y = "Relative Influence (0-1)", 
       title = "Data", color="Cue") +
  
  geom_hline(yintercept = 0.5, linetype=2, alpha=0.6)
  
RI_final
```
```{r RI_model graph}
RI_predict <- ggeffects::ggpredict(modelFull, terms = c("age_c", "cueMM")) %>%
  as_tibble() %>%
  mutate(cuePredict = factor(if_else(group == 1, true = "boundary", false = "landmark"),
                      levels = c("boundary", "landmark")))
  
RI_model <- ggplot(RI_predict, aes(x = x, y = predicted, colour = cuePredict, fill = cuePredict)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2, linetype=0) +
  geom_line(size = 0.5) +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary", "Landmark")) +
  scale_fill_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary", "Landmark")) +
  scale_x_continuous(breaks = sort(unique(Age_c$age_c)), labels = c("8", "9", "10", "11", "12", "13", "14", "15")) +
  scale_y_continuous(breaks = c(0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), limits = c(0.2, 0.8)) +
  theme_cowplot() +
  labs(x="Age", y=" ", color="Cue", fill="Cue", 
       title = "Mixed Model") + 
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.5, linetype=2, alpha=0.6)

RI_model
```

```{r graphs together}
layout <- "
AAAAA#BBBBBB
AAAAA#BBBBBB
AAAAA#BBBBBB
"

g_final <- RI_final + RI_model &
  plot_layout(design=layout) &
  theme(axis.title = element_text(size = 10), axis.text = element_text(size=10), 
        legend.title = element_text(size=10), legend.text = element_text(size=10),
        legend.position = "bottom",
        plot.title = element_text(size=12, face="italic"),
        plot.tag = element_text(size = 10, face="bold")) &
  plot_annotation(title = 'Positional Memory',
                  theme = theme(plot.title = element_text(size = 12, face="bold")),
                  tag_levels = list(c('A', 'B')))

g_final

ggsave("relativeInfluence_final.pdf", plot=g_final, units = "cm", width = 15, height = 9, 
       dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("relativeInfluence_final.png", plot=g_final, units = "cm", width = 15, height = 9, 
       dpi = "retina", device = "png", path = here("figures"))
```

#recoded relative influence

```{r}
formulaFullNext <- "correct_RI ~ age_c*cueMM + ( 1 + cueMM | ID)" 
modelFullNext <- lmer(formula = formulaFullNext, data=subset_RI)
summary(modelFullNext)
```

```{r} 
controlFinalNext <- "correct_RI ~ age_c + cueMM + (1 + cueMM | ID)" 
modelControlNext <- lmer(formula = controlFinalNext, data=subset_RI)
ratioFullModelNext <- anova(modelFullNext, modelControlNext)
ratioFullModelNext
```

```{r RI_final graph next}
RI_final <- ggplot(relativeInfluenceBlocks, aes(age, corCueRI, color=cue)) + 
  theme_cowplot() +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, guide = FALSE) +
  stat_summary(fun=mean, aes(group=cue), geom="line", size = 1.5) +
  stat_summary(fun=mean, aes(group=cue), geom="point", size = 2) +
  stat_summary(fun.data=mean_se, aes(group=cue),  
               geom="errorbar", size=0.8, width=0.1, alpha=0.95) +
  new_scale_color() + 
  geom_point(aes(color=cue)) + 
  scale_color_scico_d(palette = 'tokyo', begin=0.3, end=0.7, labels = c("Boundary", "Landmark")) +
  scale_x_continuous(breaks = c(8,9,10,11,12,13,14,15)) +
  scale_y_continuous(limits = c(0.2, 0.8), breaks = c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)) +
  labs(x= "Age", y = "Relative Influence (0-1)", 
       title = "Data", color="Cue") +
  
  geom_hline(yintercept = 0.5, linetype=2, alpha=0.6)
  
RI_final
```


```{r RI_model graph next}
RI_predict <- ggeffects::ggpredict(modelFullNext, terms = c("age_c", "cueMM")) %>%
  as_tibble() %>%
  mutate(cuePredict = factor(if_else(group == 1, true = "boundary", false = "landmark"),
                      levels = c("boundary", "landmark")))
  
RI_model <- ggplot(RI_predict, aes(x = x, y = predicted, colour = cuePredict, fill = cuePredict)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2, linetype=0) +
  geom_line(size = 0.5) +
  scale_color_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary", "Landmark")) +
  scale_fill_scico_d(palette = 'tokyo', begin=0.2, end=0.8, labels = c("Boundary", "Landmark")) +
  scale_x_continuous(breaks = sort(unique(Age_c$age_c)), labels = c("8", "9", "10", "11", "12", "13", "14", "15")) +
  scale_y_continuous(breaks = c(0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), limits = c(0.2, 0.8)) +
  theme_cowplot() +
  labs(x="Age", y=" ", color="Cue", fill="Cue", 
       title = "Mixed Model") + 
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.5, linetype=2, alpha=0.6)

RI_model
```

```{r graphs together next}
layout <- "
AAAAA#BBBBBB
AAAAA#BBBBBB
AAAAA#BBBBBB
"

g_final_next <- RI_final + RI_model &
  plot_layout(design=layout) &
  theme(axis.title = element_text(size = 10), axis.text = element_text(size=10), 
        legend.title = element_text(size=10), legend.text = element_text(size=10),
        legend.position = "bottom",
        plot.title = element_text(size=12, face="italic"),
        plot.tag = element_text(size = 10, face="bold")) &
  plot_annotation(title = 'Positional Memory',
                  theme = theme(plot.title = element_text(size = 12, face="bold")),
                  tag_levels = list(c('A', 'B')))

g_final

ggsave("relativeInfluence_finalNew.pdf", plot=g_final_next, units = "cm", width = 15, height = 9, 
       dpi = "retina", device = cairo_pdf, path = here("figures"))
ggsave("relativeInfluence_finalNew.png", plot=g_final_next, units = "cm", width = 15, height = 9, 
       dpi = "retina", device = "png", path = here("figures"))
```

